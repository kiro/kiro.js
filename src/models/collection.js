// Generated by CoffeeScript 1.4.0
(function() {
  var common, models,
    __slice = [].slice;

  models = window.BC.namespace("models");

  common = window.BC.namespace("common");

  models.collection = function() {
    var allItems, collection, filter, items, toPredicate, update;
    allItems = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    items = allItems;
    filter = function() {
      return true;
    };
    collection = function() {
      var args;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      if (args.length === 0) {
        return items;
      } else {
        allItems = args;
        return update();
      }
    };
    update = function() {
      items = _.filter(allItems, filter);
      return this.publish(items);
    };
    toPredicate = function(arg) {
      if (!_.isFunction(arg)) {
        return function(item) {
          return item === arg;
        };
      } else {
        return arg;
      }
    };
    collection.add = function(arg) {
      if (_.isArray(arg)) {
        allItems = allItems.concat(arg);
      } else {
        allItems.push(arg);
      }
      return update();
    };
    collection.remove = function(arg) {
      allItems = _.filter(allItems, toPredicate(arg));
      return update();
    };
    collection.filter = function(arg) {
      filter = toPredicate(arg);
      return update();
    };
    collection.count = function(arg) {
      if (_.isUndefined(arg)) {
        return items.length;
      } else if (_.isFunction(arg)) {
        return _.reduce(items, (function(memo, item) {
          if (arg(item)) {
            return 1 + memo;
          } else {
            return memo;
          }
        }), 0);
      } else {
        throw Error(arg + " is expected to be function or undefined");
      }
    };
    colleciton.replace = function(oldValue, newValue) {
      var i, predicate, _i, _ref;
      predicate = toPredicate(oldValue);
      for (i = _i = 0, _ref = allItems.length; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
        if (predicate(allItems[i])) {
          allItems[i] = newValue;
        }
      }
      return update();
    };
    collection.replaceAll = function() {
      var newItems;
      newItems = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      allItems = newItems;
      return update();
    };
    collection.put = function(index, item) {
      allItems[index] = item;
      return update();
    };
    return $.extend(collection, common.observable());
  };

}).call(this);
